<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: server.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: server.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>var express = require('express')
var app = express()
var router = express.Router()
var path = require('path')
var bodyParser = require('body-parser')

// models

// viewed at http://localhost:8080
app.use(bodyParser.urlencoded({ extended: false }))
app.use(bodyParser.json())
app.set('view engine', 'html')
app.get('/', function (req, res) {
  res.sendFile(path.join(__dirname + '/index.html'))
})

app.use('/CSS', express.static(__dirname + '/CSS'))
app.use('/HTML', express.static(__dirname + '/HTML'))
app.use('/Script', express.static(__dirname + '/Script'))
app.use('/models', express.static(__dirname + '/models'))
app.use('/assets', express.static(__dirname + '/Image'))

// app.get('//HTML/CreateEvent.html', function (req, res,next) {
//    res.sendFile(path.join(__dirname + "/admin.html"));
//    app.use(function(req, res, next) {
//       next();
//    });
// })

var Airtable = require('airtable')
Airtable.configure({
  endpointUrl: 'https://api.airtable.com',
  apiKey: 'key3aAov6nCuefMUX'
})
var base = Airtable.base('appv0XuVYZCSh5sX0')

app.post('/create', function (req, res, next) {
  base('Events').create({
    'Name': req.body.Name,
    'People': req.body.People,
	 'Times': req.body.TimesObjects,
	'Tasks': req.body.Tasks
  }, function (err, record) {
    if (err) { console.error(err); return }
    res.send(record)
  })
})

/**
*	@Function		eachPage &amp;&amp; "/admin/events"
*	Each page is just a singular HTML file that will hold all of the events for said day. It takes
*	the record of the information and the following day as parameters. It will then display
*	this information within the HTML page.
*
*	@pre		records-information based on the events
*			fetchNextPage- gets the next day of the month to make a clickable link.
*	@post		no return
*	@version	1.0
*	@since		September 17, 2017
*
*/

app.get("/events", function(req,res,next){
   var eventsArr = [];
   base('Events').select({
         view: "Grid view"
   }
   ).eachPage(function page(records, fetchNextPage) {
      // This function (`page`) will get called for each page of records.
      records.forEach(function(record) {
               record.fields.Id = record.id
               eventsArr.push(record.fields);
         });
      fetchNextPage();
      }, function done(err) {
         if (err) { console.error(err); return; }
         res.send(eventsArr);
         next()
         })
})

//update route
app.route('/event/:id')
   .post(function(req,res){
    var people;
      base('Events').find(req.params.id, function(err, record) {
        if (err) { console.error(err); return; }
        people = JSON.parse(record.fields.People)
        people.push(req.body)
        people = JSON.stringify(people)
        base('Events').update(req.params.id, {
        "People": people
      }, function(err, record) {
          if (err) { console.error(err); return; }
          res.send(record)
         });      
    });
        
  })

app.route('/tasklist/:id')
   .post(function(req,res){
    var tasks = JSON.stringify(req.body)
        base('Events').update(req.params.id, {
      "Tasks": tasks
    }, function(err, record) {
        if (err) { console.error(err); return; }
    });
  })

var port = 8080
app.listen(port)
console.log('App running on port ', port)
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#eachPage&&%2522/admin/events%2522EachpageisjustasingularHTMLfilethatwillholdalloftheeventsforsaidday.Ittakestherecordoftheinformationandthefollowingdayasparameters.ItwillthendisplaythisinformationwithintheHTMLpage.">eachPage && "/admin/events"	Each page is just a singular HTML file that will hold all of the events for said day. It takes	the record of the information and the following day as parameters. It will then display	this information within the HTML page.</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sun Oct 08 2017 18:37:21 GMT-0500 (Central Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
